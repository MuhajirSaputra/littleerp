BEGIN;
CREATE TABLE "payroll_payroll" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "customer_id" integer NOT NULL UNIQUE REFERENCES "crm_customer" ("id"));
CREATE TABLE "payroll_payrolldecreasedetail" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL);
CREATE TABLE "payroll_payrolldecreaseitem" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(25) NOT NULL);
CREATE TABLE "payroll_payrollincreasedetail" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL, "customer_id" integer NOT NULL REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
CREATE TABLE "payroll_payrollincreaseitem" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(25) NOT NULL);
CREATE TABLE "payroll_payrollperiod" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_created" date NOT NULL);
CREATE TABLE "payroll_payrollincreasedetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL, "customer_id" integer NOT NULL REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"), "item_id" integer NOT NULL REFERENCES "payroll_payrollincreaseitem" ("id"));
INSERT INTO "payroll_payrollincreasedetail__new" ("item_id", "customer_id", "id", "value", "employee_id") SELECT NULL, "customer_id", "id", "value", "employee_id" FROM "payroll_payrollincreasedetail";
DROP TABLE "payroll_payrollincreasedetail";
ALTER TABLE "payroll_payrollincreasedetail__new" RENAME TO "payroll_payrollincreasedetail";
CREATE INDEX "payroll_payrollincreasedetail_cb24373b" ON "payroll_payrollincreasedetail" ("customer_id");
CREATE INDEX "payroll_payrollincreasedetail_dcc97e32" ON "payroll_payrollincreasedetail" ("employee_id");
CREATE INDEX "payroll_payrollincreasedetail_82bfda79" ON "payroll_payrollincreasedetail" ("item_id");
CREATE TABLE "payroll_payrollincreasedetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL, "customer_id" integer NOT NULL REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"), "item_id" integer NOT NULL REFERENCES "payroll_payrollincreaseitem" ("id"), "payroll_id" integer NOT NULL UNIQUE REFERENCES "payroll_payroll" ("id"));
INSERT INTO "payroll_payrollincreasedetail__new" ("employee_id", "value", "payroll_id", "item_id", "customer_id", "id") SELECT "employee_id", "value", NULL, "item_id", "customer_id", "id" FROM "payroll_payrollincreasedetail";
DROP TABLE "payroll_payrollincreasedetail";
ALTER TABLE "payroll_payrollincreasedetail__new" RENAME TO "payroll_payrollincreasedetail";
CREATE INDEX "payroll_payrollincreasedetail_cb24373b" ON "payroll_payrollincreasedetail" ("customer_id");
CREATE INDEX "payroll_payrollincreasedetail_dcc97e32" ON "payroll_payrollincreasedetail" ("employee_id");
CREATE INDEX "payroll_payrollincreasedetail_82bfda79" ON "payroll_payrollincreasedetail" ("item_id");
CREATE TABLE "payroll_payrolldecreasedetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL, "item_id" integer NOT NULL REFERENCES "payroll_payrolldecreaseitem" ("id"));
INSERT INTO "payroll_payrolldecreasedetail__new" ("item_id", "id", "value") SELECT NULL, "id", "value" FROM "payroll_payrolldecreasedetail";
DROP TABLE "payroll_payrolldecreasedetail";
ALTER TABLE "payroll_payrolldecreasedetail__new" RENAME TO "payroll_payrolldecreasedetail";
CREATE INDEX "payroll_payrolldecreasedetail_82bfda79" ON "payroll_payrolldecreasedetail" ("item_id");
CREATE TABLE "payroll_payrolldecreasedetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL, "item_id" integer NOT NULL REFERENCES "payroll_payrolldecreaseitem" ("id"), "payroll_id" integer NOT NULL UNIQUE REFERENCES "payroll_payroll" ("id"));
INSERT INTO "payroll_payrolldecreasedetail__new" ("item_id", "id", "value", "payroll_id") SELECT "item_id", "id", "value", NULL FROM "payroll_payrolldecreasedetail";
DROP TABLE "payroll_payrolldecreasedetail";
ALTER TABLE "payroll_payrolldecreasedetail__new" RENAME TO "payroll_payrolldecreasedetail";
CREATE INDEX "payroll_payrolldecreasedetail_82bfda79" ON "payroll_payrolldecreasedetail" ("item_id");
CREATE TABLE "payroll_payroll__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "customer_id" integer NOT NULL UNIQUE REFERENCES "crm_customer" ("id"));
INSERT INTO "payroll_payroll__new" ("customer_id", "id") SELECT "customer_id", "id" FROM "payroll_payroll";
DROP TABLE "payroll_payroll";
ALTER TABLE "payroll_payroll__new" RENAME TO "payroll_payroll";
CREATE TABLE "payroll_payroll__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "customer_id" integer NOT NULL UNIQUE REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL UNIQUE REFERENCES "hrm_employee" ("id"));
INSERT INTO "payroll_payroll__new" ("customer_id", "id", "employee_id") SELECT "customer_id", "id", NULL FROM "payroll_payroll";
DROP TABLE "payroll_payroll";
ALTER TABLE "payroll_payroll__new" RENAME TO "payroll_payroll";
CREATE TABLE "payroll_payroll__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "customer_id" integer NOT NULL UNIQUE REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL UNIQUE REFERENCES "hrm_employee" ("id"));
INSERT INTO "payroll_payroll__new" ("customer_id", "id", "employee_id") SELECT "customer_id", "id", "employee_id" FROM "payroll_payroll";
DROP TABLE "payroll_payroll";
ALTER TABLE "payroll_payroll__new" RENAME TO "payroll_payroll";
CREATE TABLE "payroll_payroll__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "customer_id" integer NOT NULL UNIQUE REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL UNIQUE REFERENCES "hrm_employee" ("id"), "period_id" integer NOT NULL UNIQUE REFERENCES "payroll_payrollperiod" ("id"));
INSERT INTO "payroll_payroll__new" ("customer_id", "period_id", "id", "employee_id") SELECT "customer_id", NULL, "id", "employee_id" FROM "payroll_payroll";
DROP TABLE "payroll_payroll";
ALTER TABLE "payroll_payroll__new" RENAME TO "payroll_payroll";
CREATE TABLE "payroll_payrollincreasedetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "value" decimal NOT NULL, "customer_id" integer NOT NULL REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"), "item_id" integer NOT NULL REFERENCES "payroll_payrollincreaseitem" ("id"), "payroll_id" integer NOT NULL UNIQUE REFERENCES "payroll_payroll" ("id"), UNIQUE ("employee_id", "customer_id"));
INSERT INTO "payroll_payrollincreasedetail__new" ("employee_id", "value", "payroll_id", "item_id", "customer_id", "id") SELECT "employee_id", "value", "payroll_id", "item_id", "customer_id", "id" FROM "payroll_payrollincreasedetail";
DROP TABLE "payroll_payrollincreasedetail";
ALTER TABLE "payroll_payrollincreasedetail__new" RENAME TO "payroll_payrollincreasedetail";
CREATE INDEX "payroll_payrollincreasedetail_cb24373b" ON "payroll_payrollincreasedetail" ("customer_id");
CREATE INDEX "payroll_payrollincreasedetail_dcc97e32" ON "payroll_payrollincreasedetail" ("employee_id");
CREATE INDEX "payroll_payrollincreasedetail_82bfda79" ON "payroll_payrollincreasedetail" ("item_id");
CREATE TABLE "payroll_payroll__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "customer_id" integer NOT NULL UNIQUE REFERENCES "crm_customer" ("id"), "employee_id" integer NOT NULL UNIQUE REFERENCES "hrm_employee" ("id"), "period_id" integer NOT NULL UNIQUE REFERENCES "payroll_payrollperiod" ("id"), UNIQUE ("customer_id", "employee_id", "period_id"));
INSERT INTO "payroll_payroll__new" ("customer_id", "period_id", "id", "employee_id") SELECT "customer_id", "period_id", "id", "employee_id" FROM "payroll_payroll";
DROP TABLE "payroll_payroll";
ALTER TABLE "payroll_payroll__new" RENAME TO "payroll_payroll";

COMMIT;
