BEGIN;
CREATE TABLE "hrm_annualleave" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "year" date NOT NULL, "day_allowed" smallint NULL, "remaining_day_allowed" smallint NULL, "last_update" date NOT NULL);
CREATE TABLE "hrm_division" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(20) NOT NULL, "description" text NOT NULL);
CREATE TABLE "hrm_education" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "grade" varchar(2) NOT NULL, "name" varchar(50) NOT NULL, "address" varchar(100) NOT NULL, "city" varchar(25) NOT NULL, "graduation_date" date NOT NULL, "certificate" bool NOT NULL, "certificate_number" varchar(30) NOT NULL, "description" varchar(255) NOT NULL);
CREATE TABLE "hrm_employee" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "reg_number" varchar(6) NOT NULL UNIQUE, "first_name" varchar(50) NOT NULL, "last_name" varchar(50) NOT NULL, "birth_place" varchar(25) NOT NULL, "birth_date" date NOT NULL, "phone_number" varchar(15) NULL, "gender" varchar(1) NOT NULL, "bank_account" varchar(20) NULL, "religion" varchar(10) NOT NULL, "id_number" varchar(15) NULL, "mother_name" varchar(30) NOT NULL, "blood_type" varchar(2) NOT NULL, "date_of_hire" date NOT NULL, "marital_status" varchar(3) NOT NULL, "is_active" bool NOT NULL, "division_id" integer NOT NULL REFERENCES "hrm_division" ("id"));
CREATE TABLE "hrm_employeeaddress" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "address" varchar(255) NOT NULL, "district" varchar(255) NOT NULL, "city" varchar(255) NOT NULL, "province" varchar(255) NOT NULL, "address_status" varchar(8) NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
CREATE TABLE "hrm_evaluation" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_created" date NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
CREATE TABLE "hrm_evaluationdetail" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "eval_value" text NOT NULL);
CREATE TABLE "hrm_evaluationitem" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(50) NOT NULL, "description" text NOT NULL);
CREATE TABLE "hrm_evaluationperiod" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "evaluation_date" date NOT NULL, "period" varchar(50) NULL);
CREATE TABLE "hrm_familyofemployee" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(50) NOT NULL, "birth_place" varchar(25) NOT NULL, "birth_date" date NOT NULL, "id_number" varchar(15) NULL, "gender" varchar(1) NOT NULL, "relationship" varchar(1) NOT NULL, "activity" varchar(50) NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
CREATE TABLE "hrm_jobtitle" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(20) NOT NULL, "description" text NOT NULL);
CREATE TABLE "hrm_leavetaken" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "from_date" date NOT NULL, "to_date" date NOT NULL, "day" smallint NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
CREATE TABLE "hrm_leavetype" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(50) NOT NULL);
CREATE TABLE "hrm_leavetaken__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "from_date" date NOT NULL, "to_date" date NOT NULL, "day" smallint NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"), "leave_type_id" integer NOT NULL REFERENCES "hrm_leavetype" ("id"));
INSERT INTO "hrm_leavetaken__new" ("employee_id", "leave_type_id", "day", "from_date", "to_date", "id") SELECT "employee_id", NULL, "day", "from_date", "to_date", "id" FROM "hrm_leavetaken";
DROP TABLE "hrm_leavetaken";
ALTER TABLE "hrm_leavetaken__new" RENAME TO "hrm_leavetaken";
CREATE INDEX "hrm_employee_9ff3405c" ON "hrm_employee" ("division_id");
CREATE INDEX "hrm_employeeaddress_dcc97e32" ON "hrm_employeeaddress" ("employee_id");
CREATE INDEX "hrm_evaluation_dcc97e32" ON "hrm_evaluation" ("employee_id");
CREATE INDEX "hrm_familyofemployee_dcc97e32" ON "hrm_familyofemployee" ("employee_id");
CREATE INDEX "hrm_leavetaken_dcc97e32" ON "hrm_leavetaken" ("employee_id");
CREATE INDEX "hrm_leavetaken_3989ef2d" ON "hrm_leavetaken" ("leave_type_id");
CREATE TABLE "hrm_evaluationdetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "eval_value" text NOT NULL, "eval_item_id" integer NOT NULL REFERENCES "hrm_evaluationitem" ("id"));
INSERT INTO "hrm_evaluationdetail__new" ("eval_item_id", "eval_value", "id") SELECT NULL, "eval_value", "id" FROM "hrm_evaluationdetail";
DROP TABLE "hrm_evaluationdetail";
ALTER TABLE "hrm_evaluationdetail__new" RENAME TO "hrm_evaluationdetail";
CREATE INDEX "hrm_evaluationdetail_bbc83eac" ON "hrm_evaluationdetail" ("eval_item_id");
CREATE TABLE "hrm_evaluationdetail__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "eval_value" text NOT NULL, "eval_item_id" integer NOT NULL REFERENCES "hrm_evaluationitem" ("id"), "evaluation_id" integer NOT NULL REFERENCES "hrm_evaluation" ("id"));
INSERT INTO "hrm_evaluationdetail__new" ("eval_item_id", "eval_value", "evaluation_id", "id") SELECT "eval_item_id", "eval_value", NULL, "id" FROM "hrm_evaluationdetail";
DROP TABLE "hrm_evaluationdetail";
ALTER TABLE "hrm_evaluationdetail__new" RENAME TO "hrm_evaluationdetail";
CREATE INDEX "hrm_evaluationdetail_bbc83eac" ON "hrm_evaluationdetail" ("eval_item_id");
CREATE INDEX "hrm_evaluationdetail_a7f117cb" ON "hrm_evaluationdetail" ("evaluation_id");
CREATE TABLE "hrm_evaluation__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_created" date NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"), "eval_period_id" integer NOT NULL REFERENCES "hrm_evaluationperiod" ("id"));
INSERT INTO "hrm_evaluation__new" ("eval_period_id", "date_created", "employee_id", "id") SELECT NULL, "date_created", "employee_id", "id" FROM "hrm_evaluation";
DROP TABLE "hrm_evaluation";
ALTER TABLE "hrm_evaluation__new" RENAME TO "hrm_evaluation";
CREATE INDEX "hrm_evaluation_dcc97e32" ON "hrm_evaluation" ("employee_id");
CREATE INDEX "hrm_evaluation_c9afe3e4" ON "hrm_evaluation" ("eval_period_id");
CREATE TABLE "hrm_employee__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "reg_number" varchar(6) NOT NULL UNIQUE, "first_name" varchar(50) NOT NULL, "last_name" varchar(50) NOT NULL, "birth_place" varchar(25) NOT NULL, "birth_date" date NOT NULL, "phone_number" varchar(15) NULL, "gender" varchar(1) NOT NULL, "bank_account" varchar(20) NULL, "religion" varchar(10) NOT NULL, "id_number" varchar(15) NULL, "mother_name" varchar(30) NOT NULL, "blood_type" varchar(2) NOT NULL, "date_of_hire" date NOT NULL, "marital_status" varchar(3) NOT NULL, "is_active" bool NOT NULL, "division_id" integer NOT NULL REFERENCES "hrm_division" ("id"), "job_title_id" integer NOT NULL REFERENCES "hrm_jobtitle" ("id"));
INSERT INTO "hrm_employee__new" ("reg_number", "phone_number", "first_name", "last_name", "id_number", "gender", "marital_status", "is_active", "blood_type", "division_id", "religion", "job_title_id", "birth_place", "mother_name", "birth_date", "id", "bank_account", "date_of_hire") SELECT "reg_number", "phone_number", "first_name", "last_name", "id_number", "gender", "marital_status", "is_active", "blood_type", "division_id", "religion", NULL, "birth_place", "mother_name", "birth_date", "id", "bank_account", "date_of_hire" FROM "hrm_employee";
DROP TABLE "hrm_employee";
ALTER TABLE "hrm_employee__new" RENAME TO "hrm_employee";
CREATE INDEX "hrm_employee_9ff3405c" ON "hrm_employee" ("division_id");
CREATE INDEX "hrm_employee_7c3d35d3" ON "hrm_employee" ("job_title_id");
CREATE TABLE "hrm_education__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "grade" varchar(2) NOT NULL, "name" varchar(50) NOT NULL, "address" varchar(100) NOT NULL, "city" varchar(25) NOT NULL, "graduation_date" date NOT NULL, "certificate" bool NOT NULL, "certificate_number" varchar(30) NOT NULL, "description" varchar(255) NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
INSERT INTO "hrm_education__new" ("city", "employee_id", "name", "certificate", "certificate_number", "grade", "graduation_date", "address", "id", "description") SELECT "city", NULL, "name", "certificate", "certificate_number", "grade", "graduation_date", "address", "id", "description" FROM "hrm_education";
DROP TABLE "hrm_education";
ALTER TABLE "hrm_education__new" RENAME TO "hrm_education";
CREATE INDEX "hrm_education_dcc97e32" ON "hrm_education" ("employee_id");
CREATE TABLE "hrm_annualleave__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "year" date NOT NULL, "day_allowed" smallint NULL, "remaining_day_allowed" smallint NULL, "last_update" date NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"));
INSERT INTO "hrm_annualleave__new" ("employee_id", "year", "last_update", "remaining_day_allowed", "day_allowed", "id") SELECT NULL, "year", "last_update", "remaining_day_allowed", "day_allowed", "id" FROM "hrm_annualleave";
DROP TABLE "hrm_annualleave";
ALTER TABLE "hrm_annualleave__new" RENAME TO "hrm_annualleave";
CREATE INDEX "hrm_annualleave_dcc97e32" ON "hrm_annualleave" ("employee_id");
CREATE TABLE "hrm_annualleave__new" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "year" date NOT NULL, "day_allowed" smallint NULL, "remaining_day_allowed" smallint NULL, "last_update" date NOT NULL, "employee_id" integer NOT NULL REFERENCES "hrm_employee" ("id"), "leave_type_id" integer NOT NULL REFERENCES "hrm_leavetype" ("id"));
INSERT INTO "hrm_annualleave__new" ("employee_id", "year", "leave_type_id", "last_update", "remaining_day_allowed", "day_allowed", "id") SELECT "employee_id", "year", NULL, "last_update", "remaining_day_allowed", "day_allowed", "id" FROM "hrm_annualleave";
DROP TABLE "hrm_annualleave";
ALTER TABLE "hrm_annualleave__new" RENAME TO "hrm_annualleave";
CREATE INDEX "hrm_annualleave_dcc97e32" ON "hrm_annualleave" ("employee_id");
CREATE INDEX "hrm_annualleave_3989ef2d" ON "hrm_annualleave" ("leave_type_id");

COMMIT;
